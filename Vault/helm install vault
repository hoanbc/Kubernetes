###Install vault
[root@srv-master1 vault]# helm repo add hashicorp https://helm.releases.hashicorp.com
[root@srv-master1 vault]# kubectl create ns hbc-vault

#Install consul
[root@srv-master1 vault]# helm show values hashicorp/consul > values-consul.yaml
[root@srv-master1 vault]# vim values-consul.yaml
global:
  datacenter: hbc-k8s-cluster1

client:
  enabled: true

server:
  replicas: 2
  bootstrapExpect: 2
  disruptionBudget:
    maxUnavailable: 0
  storageClass: nfs-delete

helm install consul hashicorp/consul -n hbc-vault -f values-consul.yaml

#Install vault
[root@srv-master1 vault]# helm show values hashicorp/vault > values-vault.yaml
[root@srv-master1 vault]# vim values-vault.yaml
 ha:
    enabled: true
    replicas: 2

[root@srv-master1 vault]# helm install vault hashicorp/vault -n hbc-vault -f values-vault.yaml

#Gen key
[root@srv-master1 vault]# kubectl -n hbc-vault exec vault-0 -- vault operator init -key-shares=1 -key-threshold=1 -format=json > cluster-keys.json

[root@srv-master1 vault]# cat cluster-keys.json
{
  "unseal_keys_b64": [
    "Fu4Udbf8zbkWHMkS0Jm6hh+bGi2M+241x0seJcLNkVY="
  ],
  "unseal_keys_hex": [
    "16ee1475b7fccdb9161cc912d099ba861f9b1a2d8cfb6e35c74b1e25c2cd9156"
  ],
  "unseal_shares": 1,
  "unseal_threshold": 1,
  "recovery_keys_b64": [],
  "recovery_keys_hex": [],
  "recovery_keys_shares": 5,
  "recovery_keys_threshold": 3,
  "root_token": "hvs.paqE6e0jo8uE55M2h20T63wJ"
}

[root@srv-master1 vault]# VAULT_UNSEAL_KEY=Fu4Udbf8zbkWHMkS0Jm6hh+bGi2M+241x0seJcLNkVY=

[root@srv-master1 vault]# kubectl -n hbc-vault exec vault-0 -- vault operator unseal $VAULT_UNSEAL_KEY
Key             Value
---             -----
Seal Type       shamir
Initialized     true
Sealed          false
Total Shares    1
Threshold       1
Version         1.10.3
Storage Type    consul
Cluster Name    vault-cluster-2cc76ce9
Cluster ID      9dda7539-9832-8ee9-b2b2-5669c88b184e
HA Enabled      true
HA Cluster      https://vault-0.vault-internal:8201
HA Mode         active
Active Since    2022-07-22T17:23:38.908799737Z

[root@srv-master1 vault]# kubectl -n hbc-vault exec vault-1 -- vault operator unseal $VAULT_UNSEAL_KEY
Key                    Value
---                    -----
Seal Type              shamir
Initialized            true
Sealed                 false
Total Shares           1
Threshold              1
Version                1.10.3
Storage Type           consul
Cluster Name           vault-cluster-2cc76ce9
Cluster ID             9dda7539-9832-8ee9-b2b2-5669c88b184e
HA Enabled             true
HA Cluster             https://vault-0.vault-internal:8201
HA Mode                standby
Active Node Address    http://10.2.22.145:8200

#Create ingress for vault and login with root key hvs.paqE6e0jo8uE55M2h20T63wJ